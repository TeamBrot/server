<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>spe_ed gui</title>
</head>

<body>
    <canvas id="canvas", width="400", height="400"></canvas>
    <script type="text/javascript">
      const URL = "ws://localhost:8080/spe_ed/gui"
      const SCALING = 16;
      const colors = ["#dddddd", "#ff0000", "#00ff00", "#0000ff", "#00ffff", "#ffff00", "#ff00ff"];
      const canvas = document.getElementById("canvas");
      let ctx = canvas.getContext("2d");
      ctx.fillStyle = colors[0]
      let webSocket = new WebSocket("ws://localhost:8080/spe_ed/gui");
      let width, height;
      webSocket.onopen = function (event) {
        console.log("socket is open");
      };
      webSocket.onclose = function(event) {
        console.log("socket was closed");
      };
      webSocket.onerror = function(event) {
        console.log("error");
      }

      function drawCells(status) {
        ctx.requestAnimationFrame
        for (let y = 0; y < status.height; y++) {
          for (let x = 0; x < status.width; x++) {
            ctx.fillStyle = colors[status.cells[y][x]];
            ctx.fillRect(y * SCALING, x * SCALING, SCALING, SCALING);
          }
        }
      }

      webSocket.onmessage = function(event) {
        const status = JSON.parse(event.data);
        if (width != status.width) {
          canvas.setAttribute("width", status.width * SCALING);
          width = status.width;
          // ctx = canvas.getContext("2d");
        }
        if (height != status.height) {
          canvas.setAttribute("height", status.height * SCALING);
          height = status.height;
          // ctx = canvas.getContext("2d");
        }
        console.log("message received")
        drawCells(status)
      };
    </script>
</body>
</html>